<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Full Tanker</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #1f2937;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      animation: fadeInDown 0.6s ease;
    }
    
    .header h1 {
      font-size: 42px;
      color: white;
      margin-bottom: 8px;
      font-weight: 700;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }
    
    .header p {
      color: rgba(255,255,255,0.9);
      font-size: 16px;
    }
    
    .card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      animation: fadeInUp 0.6s ease;
      backdrop-filter: blur(10px);
    }
    
    .input-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .input-group {
      position: relative;
    }
    
    .input-group label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: #6b7280;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .input-group input[type="number"] {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #f9fafb;
    }
    
    .input-group input[type="number"]:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
    }
    
    .checkbox-wrapper {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 15px;
      background: #f3f4f6;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .checkbox-wrapper:hover {
      background: #e5e7eb;
    }
    
    .checkbox-wrapper input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: #667eea;
    }
    
    .checkbox-wrapper label {
      font-weight: 500;
      cursor: pointer;
      user-select: none;
    }
    
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102,126,234,0.4);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
    }
    
    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16,185,129,0.4);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
    }
    
    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(239,68,68,0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
      color: white;
    }
    
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(107,114,128,0.4);
    }
    
    .status-message {
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-weight: 500;
      animation: slideIn 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .status-success {
      background: #d1fae5;
      color: #065f46;
      border-left: 4px solid #10b981;
    }
    
    .status-error {
      background: #fee2e2;
      color: #991b1b;
      border-left: 4px solid #ef4444;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
    }
    
    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 14px;
      color: #6b7280;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .table-wrapper {
      overflow-x: auto;
      margin-top: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      min-width: 600px;
    }
    
    thead {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    th {
      padding: 15px 12px;
      text-align: right;
      font-weight: 600;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      white-space: nowrap;
    }
    
    th:first-child {
      text-align: left;
      border-top-left-radius: 10px;
    }
    
    th:last-child {
      border-top-right-radius: 10px;
    }
    
    td {
      padding: 15px 12px;
      text-align: right;
      border-bottom: 1px solid #f3f4f6;
      white-space: nowrap;
    }
    
    td:first-child {
      text-align: left;
      font-weight: 600;
      color: #667eea;
    }
    
    tbody tr {
      transition: background 0.2s ease;
    }
    
    tbody tr:hover {
      background: #f9fafb;
    }
    
    .chart-container {
      margin-top: 30px;
      padding: 20px;
      background: #f9fafb;
      border-radius: 15px;
    }

    .mileage-infographic {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }

    .mileage-card {
      background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      border-left: 5px solid #667eea;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .mileage-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(102,126,234,0.2);
    }

    .mileage-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 12px;
      border-bottom: 2px solid #f3f4f6;
    }

    .mileage-date {
      font-size: 14px;
      font-weight: 700;
      color: #667eea;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .mileage-badge {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .mileage-badge.average {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }

    .mileage-badge.low {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }

    .mileage-main {
      text-align: center;
      margin: 20px 0;
    }

    .mileage-value {
      font-size: 48px;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1;
      margin-bottom: 5px;
    }

    .mileage-unit {
      font-size: 14px;
      color: #6b7280;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .mileage-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 15px;
    }

    .mileage-detail-item {
      background: #f9fafb;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
    }

    .mileage-detail-label {
      font-size: 11px;
      color: #6b7280;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    .mileage-detail-value {
      font-size: 16px;
      font-weight: 700;
      color: #1f2937;
    }

    .no-mileage-data {
      text-align: center;
      padding: 40px 20px;
      color: #6b7280;
    }

    .no-mileage-data-icon {
      font-size: 48px;
      margin-bottom: 15px;
      opacity: 0.5;
    }

    .no-mileage-data-text {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .no-mileage-data-hint {
      font-size: 13px;
      color: #9ca3af;
    }
    
    h2 {
      font-size: 24px;
      color: #1f2937;
      margin-bottom: 20px;
      font-weight: 700;
    }

    .file-input-wrapper {
      display: inline-block;
      position: relative;
      overflow: hidden;
    }

    .file-input-wrapper input[type="file"] {
      position: absolute;
      left: -9999px;
    }
    
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    @media (max-width: 768px) {
      .header h1 {
        font-size: 32px;
      }
      
      .card {
        padding: 20px;
      }
      
      .button-group {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
        justify-content: center;
      }

      .input-section {
        grid-template-columns: 1fr;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      th, td {
        padding: 10px 8px;
        font-size: 12px;
      }

      .stat-value {
        font-size: 24px;
      }

      .stat-card {
        padding: 15px;
      }

      table {
        min-width: 650px;
        font-size: 13px;
      }

      .table-wrapper {
        -webkit-overflow-scrolling: touch;
      }

      .chart-container {
        padding: 15px;
        margin-top: 20px;
      }

      .mileage-infographic {
        grid-template-columns: 1fr;
      }

      .mileage-value {
        font-size: 40px;
      }

      .mileage-card {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üõµ Full Tanker</h1>
      <p>Track your fuel efficiency with style</p>
    </div>

    <div class="card">
      <div id="statusMessage"></div>

      <div class="input-section">
        <div class="input-group">
          <label>Odometer Reading (km)</label>
          <input type="number" id="odometer" placeholder="Enter km" step="0.1" />
        </div>
        <div class="input-group">
          <label>Fuel Filled (L)</label>
          <input type="number" id="liters" placeholder="Enter liters" step="0.1" />
        </div>
        <div class="input-group">
          <label>Price Paid (‚Çπ)</label>
          <input type="number" id="price" placeholder="Enter ‚Çπ" step="0.01" />
        </div>
        <div class="checkbox-wrapper">
          <input type="checkbox" id="fullTank" />
          <label for="fullTank">Full Tank</label>
        </div>
      </div>

      <div class="button-group">
        <button class="btn btn-primary" onclick="addEntry()">
          ‚ûï Add Entry
        </button>
        <button class="btn btn-success" onclick="downloadData()">
          üíæ Backup JSON
        </button>
        <div class="file-input-wrapper">
          <button class="btn btn-secondary">
            üìÇ Restore JSON
          </button>
          <input type="file" id="restoreFile" accept=".json" onchange="restoreData()" />
        </div>
        <button class="btn btn-success" onclick="exportCSV()">
          üìä Export CSV
        </button>
        <button class="btn btn-danger" onclick="resetAll()">
          üóëÔ∏è Reset All
        </button>
      </div>
    </div>

    <div class="card">
      <h2>üìä Statistics</h2>
      <div class="stats-grid" id="statsGrid"></div>
    </div>

    <div class="card">
      <h2>üìà Mileage Trend</h2>
      <p style="color: #6b7280; margin-bottom: 20px; font-size: 14px;">Track your fuel efficiency over time</p>
      <div id="mileageInfographic"></div>
    </div>

    <div class="card">
      <h2>üìù Refuel History</h2>
      <div id="historyContent"></div>
      <div class="chart-container">
        <canvas id="mileageChart"></canvas>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Initialize entries array
    let entries = [];

    // Storage helper functions
    function saveData() {
      try {
        localStorage.setItem("scooterEntries", JSON.stringify(entries));
        console.log("Data saved successfully:", entries.length, "entries");
      } catch (e) {
        console.error("Error saving data:", e);
        showStatus("Error saving data: " + e.message, "error");
      }
    }

    function loadData() {
      try {
        const saved = localStorage.getItem("scooterEntries");
        if (saved) {
          entries = JSON.parse(saved);
          console.log("Data loaded successfully:", entries.length, "entries");
        } else {
          entries = [];
          console.log("No saved data found, starting fresh");
        }
      } catch (e) {
        console.error("Error loading data:", e);
        entries = [];
        showStatus("Error loading data: " + e.message, "error");
      }
      updateDisplay();
    }

    function showStatus(msg, type) {
      const div = document.getElementById("statusMessage");
      div.innerHTML = `<div class="status-message status-${type}">${type === 'success' ? '‚úÖ' : '‚ùå'} ${msg}</div>`;
      setTimeout(() => (div.innerHTML = ""), 3000);
    }

    function addEntry() {
      const odo = parseFloat(document.getElementById("odometer").value);
      const liters = parseFloat(document.getElementById("liters").value);
      const price = parseFloat(document.getElementById("price").value);
      const isFull = document.getElementById("fullTank").checked;

      // Validation
      if (isNaN(odo) || isNaN(liters) || isNaN(price)) {
        showStatus("Please enter valid values for odometer, liters, and price.", "error");
        return;
      }

      if (odo <= 0 || liters <= 0 || price <= 0) {
        showStatus("Values must be greater than zero.", "error");
        return;
      }

      // Check if odometer reading is less than previous entry
      if (entries.length > 0) {
        const lastOdo = entries[entries.length - 1].odometer;
        if (odo <= lastOdo) {
          showStatus("Odometer reading must be greater than previous entry (" + lastOdo.toFixed(1) + " km)", "error");
          return;
        }
      }

      const newEntry = {
        id: Date.now(),
        date: new Date().toLocaleDateString("en-IN"),
        odometer: odo,
        liters: liters,
        price: price,
        fullTank: isFull,
        kmDriven: null,
        mileage: null,
      };

      entries.push(newEntry);
      console.log("Entry added:", newEntry);
      
      calculateMileage();
      saveData();
      updateDisplay();

      // Clear inputs
      document.getElementById("odometer").value = "";
      document.getElementById("liters").value = "";
      document.getElementById("price").value = "";
      document.getElementById("fullTank").checked = false;

      showStatus("Entry added successfully! Total entries: " + entries.length, "success");
    }

    function calculateMileage() {
      let lastFullIndex = -1;
      
      // Reset all mileage calculations
      for (let i = 0; i < entries.length; i++) {
        entries[i].kmDriven = null;
        entries[i].mileage = null;
      }

      // Calculate mileage between full tank entries
      for (let i = 0; i < entries.length; i++) {
        if (entries[i].fullTank) {
          if (lastFullIndex !== -1) {
            const distance = entries[i].odometer - entries[lastFullIndex].odometer;
            const fuelUsed = entries
              .slice(lastFullIndex + 1, i + 1)
              .reduce((sum, e) => sum + e.liters, 0);
            
            entries[i].kmDriven = distance;
            entries[i].mileage = fuelUsed > 0 ? distance / fuelUsed : null;
          }
          lastFullIndex = i;
        }
      }
    }

    function updateStats() {
      const statsDiv = document.getElementById("statsGrid");
      
      if (entries.length === 0) {
        statsDiv.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #6b7280;">No data yet. Add your first entry!</p>';
        return;
      }

      const mileageEntries = entries.filter(e => e.mileage !== null && e.mileage > 0);
      const totalFuel = entries.reduce((sum, e) => sum + e.liters, 0);
      const totalSpent = entries.reduce((sum, e) => sum + e.price, 0);
      const avgMileage = mileageEntries.length > 0 
        ? mileageEntries.reduce((sum, e) => sum + e.mileage, 0) / mileageEntries.length 
        : 0;
      const totalKm = entries.length > 1 
        ? entries[entries.length - 1].odometer - entries[0].odometer 
        : 0;

      statsDiv.innerHTML = `
        <div class="stat-card">
          <div class="stat-value">${avgMileage > 0 ? avgMileage.toFixed(1) : '‚Äî'}</div>
          <div class="stat-label">Avg Mileage (km/L)</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${totalKm.toFixed(0)}</div>
          <div class="stat-label">Total Distance (km)</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${totalFuel.toFixed(1)}</div>
          <div class="stat-label">Total Fuel (L)</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">‚Çπ${totalSpent.toFixed(0)}</div>
          <div class="stat-label">Total Spent</div>
        </div>
      `;
    }

    function updateDisplay() {
      console.log("Updating display with", entries.length, "entries");
      updateStats();
      updateMileageInfographic();
      
      const div = document.getElementById("historyContent");
      if (entries.length === 0) {
        div.innerHTML = "<p style='text-align: center; color: #6b7280; padding: 20px;'>No entries yet. Start tracking your mileage!</p>";
        drawChart([]);
        return;
      }

      const rows = entries.slice().reverse().map((e, i) => `
        <tr>
          <td>${entries.length - i}</td>
          <td>${e.date}</td>
          <td>${e.odometer.toFixed(1)}</td>
          <td>${e.liters.toFixed(2)}</td>
          <td>‚Çπ${e.price.toFixed(2)}</td>
          <td style="text-align: center;">${e.fullTank ? "‚úÖ" : "‚Äî"}</td>
          <td>${e.kmDriven !== null ? e.kmDriven.toFixed(1) : "‚Äî"}</td>
          <td>${e.mileage !== null ? e.mileage.toFixed(2) + " km/L" : "‚Äî"}</td>
        </tr>
      `).join("");

      div.innerHTML = `<div class="table-wrapper"><table>
        <thead><tr>
          <th>#</th><th>Date</th><th>Odometer</th><th>Fuel</th><th>Price</th>
          <th>Full</th><th>KM Driven</th><th>Mileage</th>
        </tr></thead><tbody>${rows}</tbody></table></div>`;

      const fullMileageData = entries.filter(e => e.mileage !== null && e.mileage > 0);
      drawChart(fullMileageData);
    }

    function updateMileageInfographic() {
      const infographicDiv = document.getElementById("mileageInfographic");
      const mileageEntries = entries.filter(e => e.mileage !== null && e.mileage > 0);
      
      if (mileageEntries.length === 0) {
        infographicDiv.innerHTML = `
          <div class="no-mileage-data">
            <div class="no-mileage-data-icon">‚õΩ</div>
            <div class="no-mileage-data-text">No mileage data yet</div>
            <div class="no-mileage-data-hint">Add at least two "Full Tank" entries to calculate mileage</div>
          </div>
        `;
        return;
      }

      // Calculate average for comparison
      const avgMileage = mileageEntries.reduce((sum, e) => sum + e.mileage, 0) / mileageEntries.length;

      // Create cards for each mileage entry (most recent first)
      const cards = mileageEntries.slice().reverse().map(entry => {
        // Determine badge based on performance
        let badge = 'good';
        let badgeText = 'Good';
        
        if (entry.mileage >= avgMileage * 1.1) {
          badge = 'excellent';
          badgeText = 'Excellent';
        } else if (entry.mileage < avgMileage * 0.9) {
          badge = 'low';
          badgeText = 'Below Avg';
        } else {
          badge = 'average';
          badgeText = 'Average';
        }

        const pricePerKm = entry.price / entry.kmDriven;

        return `
          <div class="mileage-card">
            <div class="mileage-card-header">
              <div class="mileage-date">üìÖ ${entry.date}</div>
              <div class="mileage-badge ${badge}">${badgeText}</div>
            </div>
            <div class="mileage-main">
              <div class="mileage-value">${entry.mileage.toFixed(1)}</div>
              <div class="mileage-unit">km/L</div>
            </div>
            <div class="mileage-details">
              <div class="mileage-detail-item">
                <div class="mileage-detail-label">Distance</div>
                <div class="mileage-detail-value">${entry.kmDriven.toFixed(0)} km</div>
              </div>
              <div class="mileage-detail-item">
                <div class="mileage-detail-label">Fuel Used</div>
                <div class="mileage-detail-value">${entry.liters.toFixed(1)} L</div>
              </div>
              <div class="mileage-detail-item">
                <div class="mileage-detail-label">Cost</div>
                <div class="mileage-detail-value">‚Çπ${entry.price.toFixed(0)}</div>
              </div>
              <div class="mileage-detail-item">
                <div class="mileage-detail-label">Cost/km</div>
                <div class="mileage-detail-value">‚Çπ${pricePerKm.toFixed(2)}</div>
              </div>
            </div>
          </div>
        `;
      }).join('');

      infographicDiv.innerHTML = `<div class="mileage-infographic">${cards}</div>`;
    }

    function downloadData() {
      if (entries.length === 0) {
        showStatus("No data to backup!", "error");
        return;
      }
      
      const blob = new Blob([JSON.stringify(entries, null, 2)], { type: "application/json" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "full-tanker-backup-" + new Date().toISOString().split("T")[0] + ".json";
      link.click();
      showStatus("Backup downloaded successfully!", "success");
    }

    function restoreData() {
      const fileInput = document.getElementById("restoreFile");
      const file = fileInput.files[0];
      
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          if (Array.isArray(data)) {
            if (confirm(`This will replace your current data (${entries.length} entries) with ${data.length} entries from the backup. Continue?`)) {
              entries = data;
              calculateMileage();
              saveData();
              updateDisplay();
              showStatus("Data restored successfully! " + entries.length + " entries loaded.", "success");
            }
          } else {
            showStatus("Invalid backup file format!", "error");
          }
        } catch (error) {
          showStatus("Error reading backup file: " + error.message, "error");
        }
        fileInput.value = "";
      };
      reader.readAsText(file);
    }

    function exportCSV() {
      if (entries.length === 0) {
        showStatus("No data to export!", "error");
        return;
      }
      
      const header = ["Date","Odometer","Fuel(L)","Price(‚Çπ)","FullTank","KM Driven","Mileage"];
      const rows = entries.map(e =>
        [e.date, e.odometer, e.liters, e.price, e.fullTank ? "Yes" : "No",
         e.kmDriven !== null ? e.kmDriven.toFixed(1) : "", 
         e.mileage !== null ? e.mileage.toFixed(2) : ""].join(",")
      );
      const csv = [header.join(","), ...rows].join("\n");
      const blob = new Blob([csv], { type: "text/csv" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "full-tanker-export-" + new Date().toISOString().split("T")[0] + ".csv";
      link.click();
      showStatus("CSV exported successfully!", "success");
    }

    function resetAll() {
      if (!confirm("‚ö†Ô∏è Are you sure you want to clear all data?\n\nThis will permanently delete all " + entries.length + " entries and cannot be undone!\n\nConsider downloading a backup first.")) {
        return;
      }
      
      localStorage.removeItem("scooterEntries");
      entries = [];
      updateDisplay();
      showStatus("All data cleared successfully!", "success");
    }

    let chart;
    function drawChart(data) {
      const ctx = document.getElementById("mileageChart");
      if (chart) {
        chart.destroy();
      }
      
      if (data.length === 0) {
        ctx.style.display = 'none';
        return;
      }
      
      ctx.style.display = 'block';

      const labels = data.map(e => e.date);
      const mileageVals = data.map(e => e.mileage);
      const avgVals = mileageVals.map((_, i) => {
        const subset = mileageVals.slice(0, i + 1);
        return subset.reduce((a,b)=>a+b,0) / subset.length;
      });

      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [
            {
              label: "Mileage (km/L)",
              data: mileageVals,
              borderColor: "#667eea",
              backgroundColor: "rgba(102,126,234,0.2)",
              fill: true,
              tension: 0.4,
              borderWidth: 3,
              pointRadius: 5,
              pointHoverRadius: 7,
            },
            {
              label: "Average Mileage",
              data: avgVals,
              borderColor: "#f59e0b",
              borderDash: [8, 4],
              fill: false,
              tension: 0.4,
              borderWidth: 2,
              pointRadius: 4,
              pointHoverRadius: 6,
            }
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: { 
            y: { 
              beginAtZero: false,
              grid: {
                color: '#e5e7eb'
              },
              title: {
                display: true,
                text: 'Mileage (km/L)',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              }
            },
            x: {
              grid: {
                display: false
              },
              title: {
                display: true,
                text: 'Date',
                font: {
                  size: 14,
                  weight: 'bold'
                }
              }
            }
          },
          plugins: {
            legend: { 
              position: "top",
              labels: {
                usePointStyle: true,
                padding: 15,
                font: {
                  size: 13,
                  weight: 600
                }
              }
            },
            tooltip: { 
              mode: "index", 
              intersect: false,
              backgroundColor: 'rgba(0,0,0,0.8)',
              padding: 12,
              titleFont: {
                size: 14,
                weight: 'bold'
              },
              bodyFont: {
                size: 13
              },
              callbacks: {
                label: function(context) {
                  let label = context.dataset.label || '';
                  if (label) {
                    label += ': ';
                  }
                  label += context.parsed.y.toFixed(2) + ' km/L';
                  return label;
                }
              }
            }
          }
        },
      });
    }

    // Load data when page loads
    window.addEventListener('load', function() {
      console.log("Page loaded, initializing...");
      loadData();
    });

    // Also try to load on DOMContentLoaded as backup
    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOM ready, initializing...");
      if (entries.length === 0) {
        loadData();
      }
    });
  </script>
</body>
</html>
